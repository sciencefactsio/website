<!doctype html>
<html lang="en" class="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wonder Nibbles - Science Facts</title>
<link rel="icon" type="image/jpeg" href="logo.jpg" />

<style>
  :root{
    --bg: #0b0f12;
    --card: #1a1a1a;
    --muted: #ffffff;
    --accent: #a855f7;
    --date-color: #a855f7;
    --shadow: 0 4px 12px rgba(0,0,0,0.3);
    --radius: 8px;
  }

  html,body{height:100%}
  body{
    margin:0;
    min-height:100%;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background:var(--bg);
    color:var(--muted);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
    box-sizing:border-box;
  }

  .wrap{
    max-width:1100px;
    margin:0 auto;
  }

  header{
    display:flex;
    gap:16px;
    align-items:center;
    margin-bottom:22px;
  }
  .brand{
    display:flex;
    gap:12px;
    align-items:center;
    text-decoration:none;
    color:inherit;
  }
  .brand:hover{
    opacity:0.8;
  }
  .logo{
    width:56px;height:56px;border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    box-shadow:var(--shadow);
    overflow:hidden;
  }
  .logo img{
    width:100%;
    height:100%;
    object-fit:cover;
  }
  h1{margin:0;font-size:20px;color:var(--muted);font-weight:500}
  p.lead{margin:4px 0 0 0;color:var(--muted); font-size:13px;opacity:0.8}


  /* Grid */
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:18px;
    margin-top:22px;
  }

  .card{
    background:var(--card);
    border-radius:var(--radius);
    overflow:hidden;
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    height:320px;
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .card:hover{ transform:translateY(-4px); box-shadow:0 6px 16px rgba(0,0,0,0.4); }
  .thumb{
    position:relative;
    width:100%;
    height:200px;
    overflow:hidden;
    background:#000;
  }
  .thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .meta{
    padding:14px;
    display:flex;
    flex-direction:column;
    gap:8px;
    color:var(--muted);
    flex:1;
    justify-content:space-between;
  }
  .title{
    font-weight:500;
    color:var(--muted);
    line-height:1.4;
    font-size:14px;
    display:-webkit-box;
    -webkit-line-clamp:2;
    line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
  }
  .row{
    display:flex;
    gap:10px;
    align-items:center;
    font-size:12px;
    margin-top:auto;
  }
  .badge{
    background:transparent;
    padding:0;
    border-radius:0;
    font-size:12px;
    color:var(--date-color);
    font-weight:500;
  }
  a, a:link, a:visited, a:active{
    color:#ffffff !important;
    text-decoration:none !important;
  }
  .thumb a, .title a, a .title{
    text-decoration:none !important;
    color:#ffffff !important;
    cursor:pointer;
  }
  .thumb a:hover, .title a:hover, a:hover .title, a:hover{
    opacity:0.8;
    text-decoration:none !important;
    color:#ffffff !important;
  }
  .meta a, .meta a:visited, .meta a:link{
    text-decoration:none !important;
    color:#ffffff !important;
  }
  .brand, .brand:visited, .brand:link{
    color:#ffffff !important;
  }

  /* Empty state */
  .empty{padding:40px;border-radius:12px;background:var(--card);box-shadow:var(--shadow);text-align:center;color:var(--muted)}

</style>
</head>
<body>
<div class="wrap" id="app">
  <header>
      <a href="https://www.youtube.com/@WonderNibbles" target="_blank" rel="noopener noreferrer" class="brand">
      <div class="logo"><img src="logo.jpg" alt="Wonder Nibbles" /></div>
      <div>
        <h1>Wonder Nibbles</h1>
        <p class="lead">The Ultimate Destination for Mind-Blowing Science, Space & Animal Facts! üß†üåç‚ú®</p>
      </div>
    </a>

  </header>

  <main id="content">
    <div id="status" class="empty">Loading feed‚Ä¶</div>
    <div id="grid" class="grid" hidden></div>
  </main>
</div>


<script>
/* ---- Utilities ---- */
function el(tag, props={}, children=null){
  const e = document.createElement(tag);
  for(const k in props) e.setAttribute(k, props[k]);
  if(children!==null) {
    if(typeof children === 'string') e.innerHTML = children;
    else children.forEach(c => e.appendChild(c));
  }
  return e;
}
function formatDate(iso){
  try{
    const d = new Date(iso);
    return d.toLocaleString(undefined, { year:'numeric', month:'short', day:'numeric' });
  }catch(e){return iso}
}
function shortText(s, n=160){
  if(!s) return '';
  return s.length>n ? s.slice(0,n).trim() + '‚Ä¶' : s;
}

/* ---- Parse the feed XML document and return array of entries ---- */
function parseFeedXml(xmlDoc){
  // xmlDoc: Document
  // The feed uses namespaces; using getElementsByTagNameNS is robust.
  const nsAtom = "http://www.w3.org/2005/Atom";
  const nsMedia = "http://search.yahoo.com/mrss/";
  const items = [];
  const entries = xmlDoc.getElementsByTagNameNS(nsAtom, "entry");
  for(let i=0;i<entries.length;i++){
    const e = entries[i];
    const title = e.getElementsByTagNameNS(nsAtom, "title")[0]?.textContent || '';
    const published = e.getElementsByTagNameNS(nsAtom, "published")[0]?.textContent || '';
    const videoId = e.getElementsByTagNameNS("http://www.youtube.com/xml/schemas/2015","videoId")[0]?.textContent 
                    || (e.getElementsByTagNameNS(nsAtom,"id")[0]?.textContent || '').replace('yt:video:','');
    // media group
    const mediaGroup = e.getElementsByTagNameNS(nsMedia, "group")[0];
    let thumb = null, desc='', views = null, rating = null;
    if(mediaGroup){
      const thumbEl = mediaGroup.getElementsByTagNameNS(nsMedia, "thumbnail")[0];
      thumb = thumbEl ? thumbEl.getAttribute('url') : null;
      const descEl = mediaGroup.getElementsByTagNameNS(nsMedia, "description")[0];
      desc = descEl ? descEl.textContent : '';
      const community = mediaGroup.getElementsByTagNameNS(nsMedia, "community")[0];
      if(community){
        const stats = community.getElementsByTagNameNS(nsMedia, "statistics")[0];
        if(stats) views = stats.getAttribute('views');
        const star = community.getElementsByTagNameNS(nsMedia, "starRating")[0];
        if(star) rating = star.getAttribute('average');
      }
    }
    items.push({
      title, published, videoId, thumb, desc, views: views ? parseInt(views,10) : 0, rating: rating ? parseFloat(rating) : null
    });
  }
  return items;
}

/* ---- Render functions ---- */
function renderGrid(items){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  if(!items.length){
    document.getElementById('status').hidden = false;
    document.getElementById('status').className = 'empty';
    document.getElementById('status').innerText = 'No videos found.';
    grid.hidden = true;
    return;
  }
  document.getElementById('status').hidden = true;
  grid.hidden = false;

  // Show only first 20 entries
  const displayItems = items.slice(0, 20);

  displayItems.forEach(it=>{
    const card = el('article',{class:'card'});
    const thumbWrap = el('div',{class:'thumb'});
    const thumbLink = el('a',{href:`https://www.youtube.com/watch?v=${it.videoId}`, target:'_blank', rel:'noopener noreferrer'});
    const img = el('img');
    img.src = it.thumb || `https://i.ytimg.com/vi/${it.videoId}/hqdefault.jpg`;
    img.alt = it.title;
    thumbLink.appendChild(img);

    // play overlay
    const play = el('div');
    play.style.position='absolute'; play.style.right='12px'; play.style.top='12px';
    play.innerHTML = `<div style="background:rgba(0,0,0,0.5);color:#fff;padding:6px 8px;border-radius:8px;font-weight:700;font-size:12px">‚ñ∂ WATCH</div>`;
    thumbWrap.style.position='relative';
    thumbWrap.appendChild(thumbLink);
    thumbWrap.appendChild(play);

    const meta = el('div',{class:'meta'});
    const titleLink = el('a',{href:`https://www.youtube.com/watch?v=${it.videoId}`, target:'_blank', rel:'noopener noreferrer'});
    const t = el('div',{class:'title'}, [document.createTextNode(it.title)]);
    titleLink.appendChild(t);
    const row = el('div',{class:'row'});
    const pub = el('div',{class:'badge'}, formatDate(it.published));
    row.appendChild(pub);

    meta.appendChild(titleLink);
    meta.appendChild(row);

    card.appendChild(thumbWrap);
    card.appendChild(meta);
    grid.appendChild(card);
  });
}

/* ---- App logic: always fetch live feed on load ---- */
let allItems = [];
const FEED_URL = 'https://www.youtube.com/feeds/videos.xml?channel_id=UC8NXLpC83TCgvUN80ZNqV3Q';

async function loadLiveFeed(){
  document.getElementById('status').hidden = false;
  document.getElementById('status').innerText = 'Fetching live feed‚Ä¶';
  document.getElementById('grid').hidden = true;
  try{
    // Try fetching YouTube RSS feed directly using CORS proxy
    // This should give us more items than rss2json free tier (which limits to 10)
    const corsProxy = 'https://corsproxy.io/?';
    const res = await fetch(corsProxy + encodeURIComponent(FEED_URL));
    if(!res.ok) throw new Error('Failed to fetch feed: ' + res.status);
    const xmlText = await res.text();
    
    // Parse XML
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xmlText, 'application/xml');
    
    // Check for parse errors
    if(xmlDoc.querySelector('parsererror')) {
      throw new Error('Failed to parse XML feed');
    }
    
    // Parse using existing function
    allItems = parseFeedXml(xmlDoc);
    
    // Sort by newest first initially
    allItems.sort((a,b)=> new Date(b.published) - new Date(a.published));
    
    // Apply current sort selection
    applySort();
  }catch(err){
    // Fallback to rss2json if direct fetch fails
    try {
      const proxyUrl = new URL('https://api.rss2json.com/v1/api.json');
      proxyUrl.searchParams.set('rss_url', FEED_URL);
      const res = await fetch(proxyUrl.toString());
      if(!res.ok) throw new Error('Failed to fetch feed: ' + res.status);
      const data = await res.json();
      if(!data.items) throw new Error('Feed returned unexpected format.');
      
      allItems = data.items.map(it=>{
        const vid = (it.guid || '').replace('yt:video:','') || (it.link && it.link.split('/').pop());
        return {
          title: it.title || '',
          published: it.pubDate || it.isoDate || '',
          videoId: vid,
          thumb: (it.thumbnail || it.enclosure?.link) || `https://i.ytimg.com/vi/${vid}/hqdefault.jpg`,
          desc: it.description || it.content || '',
          views: it.views ? parseInt(it.views,10) : (it.youtube_stat ? parseInt(it.youtube_stat,10) : 0)
        };
      });
      
      allItems.sort((a,b)=> new Date(b.published) - new Date(a.published));
      applySort();
    } catch(fallbackErr) {
      document.getElementById('status').hidden = false;
      document.getElementById('status').className = 'empty';
      document.getElementById('status').innerText = 'Error loading live feed: ' + err.message;
      console.error(err);
    }
  }
}

/* Load live feed on page load */
loadLiveFeed();

/* sorting - always sort by newest */
function applySort(){
  if(!allItems || allItems.length === 0) return;
  
  let items = allItems.slice();
  items.sort((a,b)=> {
    const dateA = new Date(a.published);
    const dateB = new Date(b.published);
    return dateB - dateA; // newest first
  });
  
  renderGrid(items);
}

</script>
</body>
</html>
